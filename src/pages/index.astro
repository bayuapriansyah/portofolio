---
import MainLayout from "../layouts/MainLayout.astro";
import Navbar from "../components/Navbar.astro";
import Hero from "../components/Hero.astro";
import About from "../components/About.astro";
import ProjectCard from "../components/ProjectCard.astro";
import Footer from "../components/Footer.astro";
import Subscribe from "../components/Subscribe.astro";
import Tools from "../components/Tools.astro";
---

<MainLayout title="Bayu Apriansyah | Full-Stack Developer">
  <Navbar />

  <Hero />

  <About />

  <Tools />

  <section id="projects" class="mt-40 reveal-section">
    <div class="flex flex-col items-center text-center mb-16">
      <h2
        class="text-4xl md:text-5xl font-black tracking-tighter text-slate-900 dark:text-white"
      >
        My Projects
      </h2>
      <p class="mt-4 text-slate-500 dark:text-slate-400 max-w-sm">
        A collection of projects I've built with passion and precision.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
      <ProjectCard
        image="/project/p1.png"
        title="Point Of Sale App"
        desc="A comprehensive POS system built with Laravel, featuring inventory management and sales analytics."
        tags={["Laravel", "MySQL", "Inventory"]}
      />
      <ProjectCard
        image="/project/p2.png"
        title="Booking Reservation"
        desc="A high-performance reservation system integrated with local payment gateways for seamless transactions."
        tags={["Tailwind", "Laravel", "Payments"]}
      />
    </div>
  </section>

  <Subscribe />

  <Footer />
</MainLayout>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";
  import { initMagnetic, splitTextMask } from "../scripts/gsapInit";

  gsap.registerPlugin(ScrollTrigger);

  const initGlobalAnimations = () => {
    // Magnetic effects
    initMagnetic(".reveal-card, button");

    splitTextMask(".reveal-section h2");

    gsap.utils.toArray(".reveal-section").forEach((section: any) => {
      const q = gsap.utils.selector(section);
      const titleChars = q("h2 .char-inner");

      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: section,
          start: "top 90%",
          toggleActions: "play none none none",
        },
      });

      tl.fromTo(
        section,
        { opacity: 0, scale: 0.995 },
        {
          opacity: 1,
          scale: 1,
          duration: 1,
          force3D: true,
          ease: "expo.out",
        },
      );

      if (titleChars.length) {
        tl.fromTo(
          titleChars,
          { y: "100%", rotate: 1 },
          {
            y: "0%",
            rotate: 0,
            stagger: 0.015,
            duration: 0.8,
            force3D: true,
            ease: "expo.out",
          },
          "-=0.8",
        );
      }
    });

    const gridReveals = [
      { trigger: "#tools .grid", targets: "#tools .reveal-card" },
      { trigger: "#projects .grid", targets: ".project-card" },
    ];

    gridReveals.forEach(({ trigger, targets }) => {
      if (document.querySelector(trigger)) {
        gsap.to(targets, {
          opacity: 1,
          y: 0,
          stagger: { amount: 0.3, grid: "auto", from: "start" },
          duration: 0.8,
          force3D: true,
          ease: "expo.out",
          scrollTrigger: {
            trigger: trigger,
            start: "top 85%",
          },
        });
      }
    });

    const contactGlass = document.querySelector("#contact .glass");
    if (contactGlass) {
      gsap.from(contactGlass, {
        scale: 0.95,
        opacity: 0,
        duration: 1,
        ease: "expo.out",
        scrollTrigger: {
          trigger: "#contact",
          start: "top 85%",
        },
      });
    }
  };

  document.addEventListener("astro:page-load", initGlobalAnimations);
</script>
